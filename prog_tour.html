
<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>General layout of the core: where new C++ code should live</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=ac02cc09edc035673794" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=ac02cc09edc035673794" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=ac02cc09edc035673794" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=ac02cc09edc035673794" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="_static/autodoc_pydantic.css?v=c7cf8c76" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=ac02cc09edc035673794" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=ac02cc09edc035673794" />
  <script src="_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=ac02cc09edc035673794"></script>

    <script src="_static/documentation_options.js?v=0a908d79"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'prog_tour';</script>
    <link rel="icon" href="_static/favicon-psi4.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Where to Get Help" href="prog_help.html" />
    <link rel="prev" title="Setting Up Your Development Environment" href="prog_setup.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
    <meta name="docbuild:last-update" content="Tuesday, 26 September 2023 02:05AM"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
    
    
      
    
    
    <img src="_static/psi4square.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/psi4square.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
        </div>
      
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">General layout of the core: where new C++ code should live</a><ul>
<li><a class="reference internal" href="#new-integral-operators">New integral operators</a></li>
<li><a class="reference internal" href="#completely-new-methods">Completely new methods</a></li>
<li><a class="reference internal" href="#integral-consuming-technologies">Integral consuming technologies</a></li>
<li><a class="reference internal" href="#exposing-c-code-to-python">Exposing C++ code to Python</a></li>
</ul>
</li>
</ul>

  </div></div>
        <div class="sidebar-primary-item">
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="prog_setup.html"
                          title="previous chapter">Setting Up Your Development Environment</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="prog_help.html"
                          title="next chapter">Where to Get Help</a></p>
  </div></div>
        <div class="sidebar-primary-item">
  <div class="tocsection sourcelink">
    <a href="_sources/prog_tour.rst.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>
        <div class="sidebar-primary-item">
<div id="searchbox"></div></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="prog_intro.html" class="nav-link">Introduction to Programming in <span style="font-family: Optima, sans-serif; text-transform: none;">P<span style="font-size: 82%;">SI</span>4</span></a></li>
    
    <li class="breadcrumb-item active" aria-current="page">General...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="general-layout-of-the-core-where-new-c-code-should-live">
<span id="sec-prog-tour"></span><h1>General layout of the core: where new C++ code should live<a class="headerlink" href="#general-layout-of-the-core-where-new-c-code-should-live" title="Link to this heading">#</a></h1>
<section id="new-integral-operators">
<h2>New integral operators<a class="headerlink" href="#new-integral-operators" title="Link to this heading">#</a></h2>
<p>Most of the heavy lifting in <span style="font-family: Optima, sans-serif; text-transform: none;">P<span style="font-size: 82%;">SI</span>4</span> is handled by libmints, which can be
found in the <a class="reference external" href="https://github.com/psi4/psi4/blob/master/psi4/src/psi4/libmints">psi4/psi4/src/psi4/libmints</a> directory.  New types of one- and
two-electron integral operators should be added here.  The Wavefunction class
<a class="reference external" href="https://github.com/psi4/psi4/blob/master/psi4/src/psi4/libmints/wavefunction.h">psi4/psi4/src/psi4/libmints/wavefunction.h</a> is also found here and is a key
part of the infrastructure.  Every energy calculation is performed by a class
that derives from Wavefunction and is accessible as a return value in the
Python layer.  The Wavefunction class contains all pertinent calculation
results, such as one-particle densities, molecular orbitals and gradients.</p>
</section>
<section id="completely-new-methods">
<h2>Completely new methods<a class="headerlink" href="#completely-new-methods" title="Link to this heading">#</a></h2>
<p>A new method that is not a modification of existing code belongs in its own
folder in <a class="reference external" href="https://github.com/psi4/psi4/blob/master/psi4/src/psi4">psi4/psi4/src/psi4</a>; see other folders in that exist in that
location for examples of setting up CMake, and make sure that the new folder is
added to <a class="reference external" href="https://github.com/psi4/psi4/blob/master/psi4/src/psi4/CMakeLists.txt">psi4/psi4/src/psi4/CMakeLists.txt</a>.  There are also a number of
variables that can be exported to be available to the user, as detailed in
<a class="reference internal" href="psithoninput.html#sec-psivariables"><span class="std std-ref">PSI Variables</span></a>.  To set these variables, the following member of
Wavefunction should be called:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">set_variable</span><span class="p">(</span><span class="s2">&quot;Variable Name&quot;</span><span class="p">,</span> <span class="n">variable_value</span><span class="p">);</span>
</pre></div>
</div>
<p>The new variable should also be documented in
<a class="reference external" href="https://github.com/psi4/psi4/blob/master/doc/sphinxman/source/glossary_psivariables.rst">psi4/doc/sphinxman/source/glossary_psivariables.rst</a>.  There are a
number of different helpers to export various quantities from the wavefunction
to external formats such as FCHK and MOLDEN.  Because the Wavefunction makes
its members available to the Python layer, any other similar export functions
should be written in python.</p>
</section>
<section id="integral-consuming-technologies">
<h2>Integral consuming technologies<a class="headerlink" href="#integral-consuming-technologies" title="Link to this heading">#</a></h2>
<p>The general philosophy in <span style="font-family: Optima, sans-serif; text-transform: none;">P<span style="font-size: 82%;">SI</span>4</span> is to try write two-electron integral
driven tasks in methods like Hartree-Fock, CIS and CPHF in terms of generalized
Fock-like matrices.  From here, a single class can be used to construct these
generalized Fock matrices, which is what libFock
(<a class="reference external" href="https://github.com/psi4/psi4/blob/master/psi4/src/psi4/libfock">psi4/psi4/src/psi4/libfock</a>) accomplishes.  A number of integral
technologies – such as integral-direct, disk-based and density fitting – are
supported in libFock, making them generally available to all elements of the
code that use the generalized Fock matrix strategy.</p>
</section>
<section id="exposing-c-code-to-python">
<span id="sec-prog-tour-exposing"></span><h2>Exposing C++ code to Python<a class="headerlink" href="#exposing-c-code-to-python" title="Link to this heading">#</a></h2>
<p>The recent push to move sections of the code that are not a bottleneck into the
Python layer requires that the C++ code is callable from Python and that its
results are accessible.  The result accessibility is addressed by populating
the appropriate variables in the Wavefunction object.  To make the code
callable from Python, we rely on the excellent <a class="reference external" href="https://pybind11.readthedocs.io/en/stable/">PyBind11</a> library
to create the bindings.  Existing code to export various <span style="font-family: Optima, sans-serif; text-transform: none;">P<span style="font-size: 82%;">SI</span>4</span> classes can
be found in <a class="reference external" href="https://github.com/psi4/psi4/blob/master/psi4/src">psi4/psi4/src</a> in the files whose name begins with <cite>export_</cite>.
The code to export functions that run entire calculations is usually found in
<a class="reference external" href="https://github.com/psi4/psi4/blob/master/psi4/src/core.cc">psi4/psi4/src/core.cc</a>.</p>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="prog_setup.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Setting Up Your Development Environment</p>
      </div>
    </a>
    <a class="right-next"
       href="prog_help.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Where to Get Help</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#new-integral-operators">New integral operators</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#completely-new-methods">Completely new methods</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#integral-consuming-technologies">Integral consuming technologies</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exposing-c-code-to-python">Exposing C++ code to Python</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div class="tocsection sourcelink">
    <a href="_sources/prog_tour.rst.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=ac02cc09edc035673794"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=ac02cc09edc035673794"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      © Copyright 2007-2023, The Psi4 Project.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.14.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>