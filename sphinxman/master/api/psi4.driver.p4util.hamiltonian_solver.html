<!-- 
#
# @BEGIN LICENSE
#
# Psi4: an open-source quantum chemistry software package
#
# Copyright (c) 2007-2017 The Psi4 Developers.
#
# The copyrights for code used from other parties are included in
# the corresponding files.
#
# This file is part of Psi4.
#
# Psi4 is free software; you can redistribute it and/or modify
# it under the terms of the GNU Lesser General Public License as published by
# the Free Software Foundation, version 3.
#
# Psi4 is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU Lesser General Public License for more details.
#
# You should have received a copy of the GNU Lesser General Public License along
# with Psi4; if not, write to the Free Software Foundation, Inc.,
# 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
#
# @END LICENSE
# -->





<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>hamiltonian_solver</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=0fcd75a3" />
    <link rel="stylesheet" type="text/css" href="../_static/psi4.css?v=5cda37dd" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=fd3f3429" />
    <link rel="stylesheet" type="text/css" href="../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css?v=a5c4661c" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" type="text/css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noticia+Text:400,i,b,bi|Open+Sans:400,i,b,bi|Roboto+Mono:400,i,b,bi&amp;display=swap" type="text/css" />
    
    <script src="../_static/documentation_options.js?v=37d5628d"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    
    
     
        <script src="../_static/jquery.cookie.js"></script>
    

    
     
        <script src="../_static/cloud.base.js"></script>
    

    
     
        <script src="../_static/cloud.js"></script>
    

    <link rel="icon" href="../_static/favicon-psi4.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="hold_options_state" href="psi4.driver.p4util.hold_options_state.html" />
    <link rel="prev" title="getattr_ignorecase" href="psi4.driver.p4util.getattr_ignorecase.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1">
  </head><body>
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">Index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="psi4.driver.p4util.hold_options_state.html" title="hold_options_state"
             accesskey="N"><i class="fa fa-long-arrow-right fa-lg"></i></a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="psi4.driver.p4util.getattr_ignorecase.html" title="getattr_ignorecase"
             accesskey="P"><i class="fa fa-long-arrow-left fa-lg"></i></a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="../index.html" title="Table Of Contents"
             accesskey="C"><i class="fa fa-book fa-lg"></i></a> &nbsp; &nbsp;</li>
    <li><a href="http://psicode.org/"><i class="fa fa-home fa-lg"></i></a></li>
    <li><a href="http://github.com/psi4/psi4"><i class="fa fa-github fa-lg"></i></a></li>
    <li><a href="http://forum.psicode.org"><i class="fa fa-comments-o fa-lg"></i></a></li>
    <li><a href="http://github.com/psi4/psi4/edit/master/doc/sphinxman/source/api/psi4.driver.p4util.hamiltonian_solver.rst"><i class="fa fa-pencil fa-lg"></i></a></li>
    <li style="color: #1a4162">&nbsp;&middot;&nbsp;</li>
    <li><a href="http://github.com/psi4/psi4/tree/ba20dd4">1.10a1.dev47</a></li>
    <li style="color: #1a4162">&nbsp;&middot;&nbsp;</li>
    <li class="nav-item nav-item-0"><a href="../index.html">
        <span style="font-family: Optima, sans-serif;">P<span style="font-size: 82%;">SI</span>4</span>
        </a><i class="fa fa-angle-double-right" style="color: #a2a7b3; text-shadow: none;"></i></li>

          <li class="nav-item nav-item-1"><a href="../psi4api.html" accesskey="U"><span style="font-family: Optima, sans-serif; text-transform: none;">P<span style="font-size: 82%;">SI</span>4</span> API: Linking C++ and Python</a><i class="fa fa-angle-double-right" style="color: #a2a7b3; text-shadow: none;"></i></li>
        <li class="nav-item nav-item-this"><a href="">hamiltonian_solver</a></li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="hamiltonian-solver">
<h1>hamiltonian_solver<a class="headerlink" href="#hamiltonian-solver" title="Link to this heading">¶</a></h1>
<dl class="py function">
<dt class="sig sig-object py" id="psi4.driver.p4util.hamiltonian_solver">
<span class="sig-prename descclassname"><span class="pre">psi4.driver.p4util.</span></span><span class="sig-name descname"><span class="pre">hamiltonian_solver</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">engine</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">guess</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nroot</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">r_convergence</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0001</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_ss_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxiter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">60</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/psi4/driver/p4util/solvers.html#hamiltonian_solver"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#psi4.driver.p4util.hamiltonian_solver" title="Link to this definition">¶</a></dt>
<dd><p>Finds the smallest eigenvalues and associated right and left hand
eigenvectors of a large real Hamiltonian eigenvalue problem emulated
through an engine.</p>
<p>A Hamiltonian eigenvalue problem (EVP) has the following structure:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">A</span>  <span class="n">B</span><span class="p">][</span><span class="n">X</span><span class="p">]</span>  <span class="o">=</span> <span class="p">[</span><span class="mi">1</span>   <span class="mi">0</span><span class="p">](</span><span class="n">w</span><span class="p">)[</span><span class="n">X</span><span class="p">]</span>
<span class="p">[</span><span class="n">B</span>  <span class="n">A</span><span class="p">][</span><span class="n">Y</span><span class="p">]</span>    <span class="p">[</span><span class="mi">0</span>  <span class="o">-</span><span class="mi">1</span><span class="p">](</span><span class="n">w</span><span class="p">)[</span><span class="n">Y</span><span class="p">]</span>
</pre></div>
</div>
<p>with A, B of some large dimension N, the problem is of dimension 2Nx2N.</p>
<p>The real, Hamiltonian EVP can be rewritten as the NxN, non-hermitian EVP:
<span class="math notranslate nohighlight">\((A+B)(A-B)(X+Y) = w^2(X+Y)\)</span></p>
<p>With left-hand eigenvectors:
<span class="math notranslate nohighlight">\((X-Y)(A-B)(A+B) = w^2(X-Y)\)</span></p>
<p>if <span class="math notranslate nohighlight">\((A-B)\)</span> is positive definite, we can transform the problem to arrive at the hermitian NxN EVP:
<span class="math notranslate nohighlight">\((A-B)^{1/2}(A+B)(A-B)^{1/2} = w^2 T\)</span></p>
<p>Where <span class="math notranslate nohighlight">\(T = (A-B)^{-1/2}(X+Y)\)</span>.</p>
<p>We use a Davidson like iteration where we transform <span class="math notranslate nohighlight">\((A+B)\)</span> (H1) and <span class="math notranslate nohighlight">\((A-B)\)</span>
(H2) in to the subspace defined by the trial vectors.
The subspace analog of the NxN hermitian EVP is diagonalized and left <span class="math notranslate nohighlight">\((X-Y)\)</span>
and right <span class="math notranslate nohighlight">\((X+Y)\)</span> eigenvectors of the NxN non-hermitian EVP are approximated.
Residual vectors are formed for both and the guess space is augmented with
two correction vectors per iteration. The advantages and properties of this
algorithm are described in the literature <a class="reference internal" href="../bibliography.html#stratmann-1998" id="id1"><span>[stratmann:1998]</span></a> .</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>engine</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3.12/library/typing.html#typing.Type" title="(in Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Type</span></code></a>[<a class="reference internal" href="psi4.driver.p4util.SolverEngine.html#psi4.driver.p4util.SolverEngine" title="psi4.driver.p4util.solvers.SolverEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">SolverEngine</span></code></a>]</span>) – The engine drive all operations involving data structures that have at
least one “large” dimension. See <a class="reference internal" href="psi4.driver.p4util.SolverEngine.html#psi4.driver.p4util.SolverEngine" title="psi4.driver.p4util.SolverEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">SolverEngine</span></code></a> for requirements</p></li>
<li><p><strong>guess</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3.12/library/typing.html#typing.List" title="(in Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code></a></span>) – list {engine dependent}
At least <cite>nroot</cite> initial expansion vectors</p></li>
<li><p><strong>nroot</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3.12/library/functions.html#int" title="(in Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a></span>) – Number of roots desired</p></li>
<li><p><strong>r_convergence</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3.12/library/functions.html#float" title="(in Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a></span>) – Convergence tolerance for residual vectors</p></li>
<li><p><strong>max_ss_size</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3.12/library/functions.html#int" title="(in Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a></span>) – The maximum number of trial vectors in the iterative subspace that will
be stored before a collapse is done.</p></li>
<li><p><strong>maxiter</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3.12/library/functions.html#int" title="(in Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a></span>) – The maximum number of iterations</p></li>
<li><p><strong>verbose</strong> (<span class="sphinx_autodoc_typehints-type"><a class="reference external" href="https://docs.python.org/3.12/library/functions.html#int" title="(in Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a></span>) – The amount of logging info to print (0 -&gt; none, 1 -&gt; some, 2 -&gt; all but matrices, &gt;2 -&gt; everything)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>best_values</strong> (<em>numpy.ndarray</em>) – (nroots, ) The best approximation of the eigenvalues of <cite>w</cite>, computed on the last iteration of the solver</p></li>
<li><p><strong>best_R</strong> (List[<cite>vector</cite>]) – (nroots) The best approximation of the  right hand eigenvectors, <span class="math notranslate nohighlight">\(X+Y\)</span>, computed on the last iteration of the solver.</p></li>
<li><p><strong>best_L</strong> (List[<cite>vector</cite>]) – (nroots) The best approximation of the left hand eigenvectors, <span class="math notranslate nohighlight">\(X-Y\)</span>, computed on the last iteration of the solver.</p></li>
<li><p><strong>stats</strong> (<em>List[Dict]</em>) – Statistics collected on each iteration</p>
<ul>
<li><p>count : int, iteration number</p></li>
<li><p>res_norm : np.ndarray (nroots, ), the norm of residual vector for each roots</p></li>
<li><p>val : np.ndarray (nroots, ), the eigenvalue corresponding to each root</p></li>
<li><p>delta_val : np.ndarray (nroots, ), the change in eigenvalue from the last iteration to this ones</p></li>
<li><p>collapse : bool, if a subspace collapse was performed</p></li>
<li><p>product_count : int, the running total of product evaluations that was performed</p></li>
<li><p>done : bool, if all roots were converged</p></li>
</ul>
</li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The solution vector is normalized to 1/2</p>
<p>The solver will return even when <cite>maxiter</cite> iterations are performed without convergence.
The caller <strong>must check</strong> <code class="docutils literal notranslate"><span class="pre">stats[-1]['done']</span></code> for failure and handle each case accordingly.</p>
<p class="rubric">References</p>
<p>R. Eric Stratmann, G. E. Scuseria, and M. J. Frisch, “An efficient
implementation of time-dependent density-functional theory for the
calculation of excitation energies of large molecules.” J. Chem. Phys.,
109, 8218 (1998)</p>
</dd></dl>

</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <p class="logo"><a href="../index.html">
    <img class="logo" src="../_static/psi4square.png" alt="Logo"/>
  </a></p>
<div id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" placeholder="&#xF002;" style="font-family:FontAwesome, Ariel"
                                       aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/></div>
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><div class="sphinx-toc sphinxlocaltoc">
    <h3><a href="../index.html">table of contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">hamiltonian_solver</a><ul>
<li><a class="reference internal" href="#psi4.driver.p4util.hamiltonian_solver"><code class="docutils literal notranslate"><span class="pre">hamiltonian_solver()</span></code></a></li>
</ul>
</li>
</ul>

  </div>
        </div>
      </div>
    
    
        <div class="sidebar-toggle-group no-js">
            
            <button class="sidebar-toggle" id="sidebar-hide" title="Hide the sidebar menu">
                 «
                <span class="show-for-small">hide menu</span>
                
            </button>
            <button class="sidebar-toggle" id="sidebar-show" title="Show the sidebar menu">
                
                <span class="show-for-small">menu</span>
                <span class="hide-for-small">sidebar</span>
                 »
            </button>
        </div>
    
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >Index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="psi4.driver.p4util.hold_options_state.html" title="hold_options_state"
             ><i class="fa fa-long-arrow-right fa-lg"></i></a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="psi4.driver.p4util.getattr_ignorecase.html" title="getattr_ignorecase"
             ><i class="fa fa-long-arrow-left fa-lg"></i></a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="../index.html" title="Table Of Contents"
             ><i class="fa fa-book fa-lg"></i></a> &nbsp; &nbsp;</li>
    <li><a href="http://psicode.org/"><i class="fa fa-home fa-lg"></i></a></li>
    <li><a href="http://github.com/psi4/psi4"><i class="fa fa-github fa-lg"></i></a></li>
    <li><a href="http://forum.psicode.org"><i class="fa fa-comments-o fa-lg"></i></a></li>
    <li><a href="http://github.com/psi4/psi4/edit/master/doc/sphinxman/source/api/psi4.driver.p4util.hamiltonian_solver.rst"><i class="fa fa-pencil fa-lg"></i></a></li>
    <li style="color: #1a4162">&nbsp;&middot;&nbsp;</li>
    <li><a href="http://github.com/psi4/psi4/tree/ba20dd4">1.10a1.dev47</a></li>
    <li style="color: #1a4162">&nbsp;&middot;&nbsp;</li>
    <li class="nav-item nav-item-0"><a href="../index.html">
        <span style="font-family: Optima, sans-serif;">P<span style="font-size: 82%;">SI</span>4</span>
        </a><i class="fa fa-angle-double-right" style="color: #a2a7b3; text-shadow: none;"></i></li>

          <li class="nav-item nav-item-1"><a href="../psi4api.html" ><span style="font-family: Optima, sans-serif; text-transform: none;">P<span style="font-size: 82%;">SI</span>4</span> API: Linking C++ and Python</a><i class="fa fa-angle-double-right" style="color: #a2a7b3; text-shadow: none;"></i></li>
        <li class="nav-item nav-item-this"><a href="">hamiltonian_solver</a></li> 
      </ul>
    </div>
    </div>

    <div class="footer" role="contentinfo">
    &#169; Copyright 2007-2024, The Psi4 Project.
      Last updated on Thursday, 08 August 2024 04:38PM.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
    </div>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>